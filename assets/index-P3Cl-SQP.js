var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{p as i}from"./phaser-C2_wa_Fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=64,r=100;var a=(e=>(e.left="left",e.right="right",e.up="up",e.down="down",e))(a||{});const n={left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:-1},down:{x:0,y:1}},o=new Phaser.Events.EventEmitter;class l extends i.Scene{constructor(){super("Game"),t(this,"level",[[r,r,r,r,r,r,r,r],[r,38,0,0,0,0,0,r],[r,0,0,52,r,8,0,r],[r,0,0,0,8,0,0,r],[r,0,9,51,r,0,0,r],[r,7,0,0,0,0,0,r],[r,0,0,0,0,51,64,r],[r,r,r,r,r,r,r,r]]),t(this,"floorLayer",null),t(this,"playbleLayer",null),t(this,"backgroundLayer",null),t(this,"cursors"),t(this,"gameMapMargin",{x:0,y:0}),t(this,"map"),t(this,"player"),t(this,"movementDirection"),t(this,"boxes",[]),t(this,"isMoving",!1),t(this,"isTouching",!1)}init(){var e;this.cursors=null==(e=this.input.keyboard)?void 0:e.createCursorKeys()}create(){var e;this.input.addPointer(1),this.createMap(),this.createPlayer(),this.createBoxes(),null==(e=this.input.keyboard)||e.on("keydown-SPACE",(()=>this.scale.isFullscreen?this.scale.stopFullscreen():this.scale.startFullscreen())),this.scene.run("UIScene")}update(){this.handlePlayerKeyInput()}createMap(){var e,t;const{width:i,height:r}=this.scale;this.map=this.make.tilemap({data:this.level,tileWidth:s,tileHeight:s,key:"level"}),[this.gameMapMargin.x,this.gameMapMargin.y]=[.5*(i-this.level[0].length*s),.5*(r-this.level.length*s)];const a=this.map.addTilesetImage("tiles");this.backgroundLayer=this.map.createBlankLayer("background",a||"noTiles",0-this.gameMapMargin.x,0-this.gameMapMargin.y,i,r),null==(e=this.backgroundLayer)||e.fill(101,0,0,i,r),this.floorLayer=this.map.createBlankLayer("floor",a||"noTiles",this.gameMapMargin.x,this.gameMapMargin.y),null==(t=this.floorLayer)||t.fill(90,0,0,this.map.width,this.map.height),this.playbleLayer=this.map.createLayer("layer",a||"noTiles",this.gameMapMargin.x,this.gameMapMargin.y)}createPlayer(){if(this.playbleLayer){const[e]=this.playbleLayer.createFromTiles(52,0,{key:"tiles",frame:52});e.setOrigin(.5).play("down-idle"),e.setData("player",!0),this.player=e}this.input.on("pointerdown",(e=>{this.isTouching=!0,this.movementDirection=this.handlePlayerTouchMovement(e),this.processPlayerMovement()})).on("pointerup",(()=>this.isTouching=!1))}createBoxes(){this.createBoxDotPair(8,51),this.createBoxDotPair(9,64),this.createBoxDotPair(7,38)}createBoxDotPair(e,t){if(!this.playbleLayer)return;const i=this.playbleLayer.createFromTiles(e,0,{key:"tiles",frame:e});i.forEach((e=>{e.setOrigin(.5),e.setData("dot",t)})),this.boxes=this.boxes.concat(i)}getBoxAt(e,t){return this.boxes.find((i=>i.getBounds().contains(e,t)))}handlePlayerKeyInput(){this.isMoving||this.player&&this.cursors&&(this.cursors.left.isDown?this.movementDirection=a.left:this.cursors.right.isDown?this.movementDirection=a.right:this.cursors.up.isDown?this.movementDirection=a.up:this.cursors.down.isDown&&(this.movementDirection=a.down),this.movementDirection&&this.processPlayerMovement())}handlePlayerTouchMovement(e){if(this.isMoving)return;if(!this.player||!e)return;const{worldX:t,worldY:i}=e,r=this.player.getBounds();return r.centerX>t&&r.y<=i&&r.y+s>=i?a.left:r.centerX<t&&r.y<=i&&r.y+s>=i?a.right:r.centerY>i&&r.x<=t&&r.x+s>=t?a.up:r.centerY<i&&r.x<=t&&r.x+s>=t?a.down:void 0}stopPlayerMovement(){var e;if(!this.player)return;this.isMoving=!1,this.isTouching||(this.movementDirection=void 0);const t=null==(e=this.player.anims.currentAnim)?void 0:e.key,i=null==t?void 0:t.split("-")[0];!this.isMoving&&i&&this.player.play(`${i}-idle`)}processPlayerMovement(){if(!this.player||!this.movementDirection)return;const e=n[this.movementDirection],t=this.getBoxAt(this.player.x+32*e.x,this.player.y+32*e.y);this.checkMovementPossibilities(this.player,e,!!t)&&(this.isMoving=!0,t&&this.moveObject(t,e,void 0,this.checkBoxInPlaceAndWinCondition(t)),this.moveObject(this.player,e,[`${this.movementDirection}-walk`,!0],this.stopPlayerMovement.bind(this))),this.isTouching||(this.movementDirection=void 0)}checkMovementPossibilities(e,t,i){var r;const{x:a,y:n}=e.getCenter(),o=i?128:s,l=a+o*t.x,h=n+o*t.y,c=null==(r=this.playbleLayer)?void 0:r.getTileAtWorldXY(l,h),m=this.getBoxAt(l,h);return!(c&&100===c.index||m)}moveObject(e,t,i,r){this.tweens.add({targets:e,x:e.x+t.x*s,y:e.y+t.y*s,duration:500,onStart:()=>i?e.play(...i):null,onComplete:r})}checkBoxInPlaceAndWinCondition(e){return function(){var t;const{x:i,y:s}=e.getCenter(),r=null==(t=this.playbleLayer)?void 0:t.getTileAtWorldXY(i,s);if(!r)return;const a=e.getData("dot")===r.index;e.setData("matched",a),a?e.postFX.addGlow(16777215,0,1.5,!1,.05,15):e.clearFX(),this.boxes.reduce(((e,t)=>t.getData("matched")?++e:e),0)===this.boxes.length&&o.emit("show-win",this)}.bind(this)}}class h extends i.Scene{constructor(){super("Preloader")}init(){const{width:e,height:t}=this.scale,i=this.add.rectangle(e/2-460,t/2,4,28,16777215).setOrigin(.5);this.load.on("progress",(e=>{i.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.spritesheet("tiles","textures/sokoban_tilesheet.png",{frameWidth:s,startFrame:0})}create(){this.createAnims(),this.startGame()}startGame(){this.scene.start("Game")}createAnims(){this.anims.create({key:"down-idle",frames:[{key:"tiles",frame:52}]}),this.anims.create({key:"up-idle",frames:[{key:"tiles",frame:55}]}),this.anims.create({key:"left-idle",frames:[{key:"tiles",frame:81}]}),this.anims.create({key:"right-idle",frames:[{key:"tiles",frame:78}]}),this.anims.create({key:"down-walk",frames:this.anims.generateFrameNumbers("tiles",{start:52,end:54}),frameRate:10,repeat:-1}),this.anims.create({key:"up-walk",frames:this.anims.generateFrameNumbers("tiles",{start:55,end:57}),frameRate:10,repeat:-1}),this.anims.create({key:"left-walk",frames:this.anims.generateFrameNumbers("tiles",{start:81,end:83}),frameRate:10,repeat:-1}),this.anims.create({key:"right-walk",frames:this.anims.generateFrameNumbers("tiles",{start:78,end:80}),frameRate:10,repeat:-1})}}class c extends i.Scene{constructor(){super("UIScene"),t(this,"level"),t(this,"labelWin"),t(this,"levelNumber",1)}create(){const{width:e,height:t}=this.scale;this.level=this.add.text(e/2,.1*t,`Level: ${this.levelNumber}`,{fontSize:"4.5rem",strokeThickness:8,stroke:"#ff471a"}).setOrigin(.5).setScrollFactor(0),this.labelWin=this.add.text(e/2,t/2,"You win!",{fontSize:"6.5rem",strokeThickness:13,stroke:"#00cc66"}).setOrigin(.5).setScrollFactor(0),this.labelWin.visible=!1,o.on("show-win",this.showWin,this)}showWin(e){this.labelWin&&this.level&&(this.labelWin.visible=!0,this.level.visible=!1,this.time.delayedCall(500,(()=>{e.scene.pause(),this.scene.pause()})))}}const m={type:Phaser.AUTO,width:540,height:960,parent:"game-container",backgroundColor:"0xff34a0",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},disableContextMenu:!0,autoMobilePipeline:!0,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!0}},scene:[h,l,c]};new Phaser.Game(m);
